<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Nutrition Chat - Label Padegha Sabh</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Fraunces:wght@600;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #10B981;
            --primary-dark: #059669;
            --secondary: #F3F4F6;
            --accent: #F59E0B;
            --danger: #EF4444;
            --dark: #1F2937;
            --light: #F9FAFB;
            --ai-bg: #8B5CF6;
            --user-bg: #10B981;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--light);
            color: var(--dark);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        h1, h2, h3, h4 {
            font-family: 'Fraunces', serif;
            font-weight: 700;
        }
        
        /* Chat Header */
        .chat-header {
            background: white;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        
        .chat-title-wrapper {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .chat-ai-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }
        
        .chat-title h1 {
            font-size: 1.5rem;
            margin: 0;
        }
        
        .chat-subtitle {
            font-size: 0.875rem;
            color: #6B7280;
            margin: 0;
        }
        
        .back-btn {
            background: var(--secondary);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            color: var(--dark);
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .back-btn:hover {
            background: #E5E7EB;
            transform: translateX(-3px);
            color: var(--dark);
        }
        
        /* Chat Container */
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            scroll-behavior: smooth;
        }
        
        .chat-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .chat-container::-webkit-scrollbar-track {
            background: var(--secondary);
            border-radius: 10px;
        }
        
        .chat-container::-webkit-scrollbar-thumb {
            background: #D1D5DB;
            border-radius: 10px;
        }
        
        .chat-container::-webkit-scrollbar-thumb:hover {
            background: #9CA3AF;
        }
        
        /* Welcome Message */
        .welcome-message {
            max-width: 700px;
            margin: 0 auto 2rem;
            text-align: center;
            animation: fadeIn 0.6s ease;
        }
        
        .welcome-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 2.5rem;
            color: white;
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
        }
        
        .welcome-message h2 {
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        
        .welcome-message p {
            color: #6B7280;
            font-size: 1.1rem;
            margin-bottom: 2rem;
        }
        
        /* Quick Questions */
        .quick-questions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            max-width: 900px;
            margin: 0 auto;
        }
        
        .quick-question-btn {
            background: white;
            border: 2px solid #E5E7EB;
            padding: 1.25rem;
            border-radius: 15px;
            text-align: left;
            transition: all 0.3s ease;
            cursor: pointer;
            font-weight: 500;
        }
        
        .quick-question-btn:hover {
            border-color: var(--ai-bg);
            background: #F9FAFB;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.2);
        }
        
        .quick-question-btn i {
            color: var(--ai-bg);
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            display: block;
        }
        
        /* Messages */
        .messages {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .message {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            animation: slideIn 0.4s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        .message.ai .message-avatar {
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
        }
        
        .message.user {
            flex-direction: row-reverse;
        }
        
        .message.user .message-avatar {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        }
        
        .message-content {
            flex: 1;
            max-width: 70%;
        }
        
        .message-bubble {
            background: white;
            padding: 1.25rem;
            border-radius: 18px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            line-height: 1.7;
        }
        
        .message.user .message-bubble {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
        }
        
        .message-time {
            font-size: 0.75rem;
            color: #9CA3AF;
            margin-top: 0.5rem;
        }
        
        .message.user .message-time {
            text-align: right;
        }
        
        /* Typing Indicator */
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .typing-indicator.active {
            display: flex;
        }
        
        .typing-bubble {
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 18px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            display: flex;
            gap: 0.5rem;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #8B5CF6;
            border-radius: 50%;
            animation: typingDot 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typingDot {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }
        
        /* Input Area */
        .input-area {
            background: white;
            border-top: 2px solid var(--secondary);
            padding: 1.5rem;
            flex-shrink: 0;
        }
        
        .input-wrapper {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
        }
        
        .input-form {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
        }
        
        .message-input {
            flex: 1;
            border: 2px solid #E5E7EB;
            border-radius: 15px;
            padding: 1rem 1.25rem;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            resize: none;
            max-height: 150px;
            transition: all 0.3s ease;
        }
        
        .message-input:focus {
            outline: none;
            border-color: var(--ai-bg);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }
        
        .send-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            border: none;
            color: white;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .send-btn:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.4);
        }
        
        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Suggestions */
        .suggestions {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .suggestion-chip {
            background: #F3F4F6;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .suggestion-chip:hover {
            background: #E5E7EB;
            transform: translateY(-2px);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .chat-header {
                padding: 1rem;
            }
            
            .chat-title h1 {
                font-size: 1.25rem;
            }
            
            .chat-container {
                padding: 1rem;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .quick-questions {
                grid-template-columns: 1fr;
            }
            
            .welcome-message h2 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    
    <!-- Chat Header -->
    <div class="chat-header">
        <div class="chat-title-wrapper">
            <div class="chat-ai-avatar">
                <i class="bi bi-robot"></i>
            </div>
            <div class="chat-title">
                <h1>AI Nutrition Assistant</h1>
                <p class="chat-subtitle">Ask me anything about nutrition, ingredients, or health</p>
            </div>
        </div>
        <a href="dashboard.html" class="back-btn">
            <i class="bi bi-arrow-left"></i>Back
        </a>
    </div>
    
    <!-- Chat Container -->
    <div class="chat-container" id="chatContainer">
        
        <!-- Welcome Message -->
        <div class="welcome-message" id="welcomeMessage">
            <div class="welcome-icon">
                <i class="bi bi-chat-heart"></i>
            </div>
            <h2>Hello! How can I help you today?</h2>
            <p>I'm your AI nutrition assistant. Ask me about ingredients, health impacts, dietary advice, or product alternatives.</p>
            
            <div class="quick-questions">
                <button class="quick-question-btn" onclick="sendQuickQuestion('What are the health benefits of dark chocolate?')">
                    <i class="bi bi-heart-pulse"></i>
                    What are the health benefits of dark chocolate?
                </button>
                <button class="quick-question-btn" onclick="sendQuickQuestion('Are artificial sweeteners safe?')">
                    <i class="bi bi-exclamation-triangle"></i>
                    Are artificial sweeteners safe?
                </button>
                <button class="quick-question-btn" onclick="sendQuickQuestion('What should I look for on nutrition labels?')">
                    <i class="bi bi-clipboard-check"></i>
                    What should I look for on nutrition labels?
                </button>
                <button class="quick-question-btn" onclick="sendQuickQuestion('Suggest healthy snack alternatives')">
                    <i class="bi bi-lightbulb"></i>
                    Suggest healthy snack alternatives
                </button>
            </div>
        </div>
        
        <!-- Messages Container -->
        <div class="messages" id="messages"></div>
        
        <!-- Typing Indicator -->
        <div class="typing-indicator" id="typingIndicator">
            <div class="message-avatar" style="background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);">
                <i class="bi bi-robot"></i>
            </div>
            <div class="typing-bubble">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>
        
    </div>
    
    <!-- Input Area -->
    <div class="input-area">
        <div class="input-wrapper">
            <div class="suggestions" id="suggestions">
                <button class="suggestion-chip" onclick="sendQuickQuestion('Tell me about E621')">Tell me about E621</button>
                <button class="suggestion-chip" onclick="sendQuickQuestion('Is palm oil bad?')">Is palm oil bad?</button>
                <button class="suggestion-chip" onclick="sendQuickQuestion('Explain NOVA food groups')">Explain NOVA groups</button>
            </div>
            <form class="input-form" id="messageForm">
                <textarea 
                    class="message-input" 
                    id="messageInput" 
                    placeholder="Type your question here..." 
                    rows="1"
                    required
                ></textarea>
                <button type="submit" class="send-btn" id="sendBtn">
                    <i class="bi bi-send-fill"></i>
                </button>
            </form>
        </div>
    </div>
    
    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Elements
        const chatContainer = document.getElementById('chatContainer');
        const messagesContainer = document.getElementById('messages');
        const messageForm = document.getElementById('messageForm');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const typingIndicator = document.getElementById('typingIndicator');
        const welcomeMessage = document.getElementById('welcomeMessage');
        const suggestions = document.getElementById('suggestions');
        
        // Auto-resize textarea
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 150) + 'px';
        });
        
        // Get user info
        const userName = localStorage.getItem('userName') || 'User';
        const userInitials = userName.split(' ').map(n => n[0]).join('').toUpperCase();
        
        // AI responses (demo data)
        const aiResponses = {
            'default': "That's a great question! Dark chocolate has several health benefits when consumed in moderation. It's rich in antioxidants, particularly flavonoids, which can help improve heart health and reduce inflammation. The higher the cocoa content (70% or above), the more beneficial compounds it contains. Dark chocolate also provides minerals like iron, magnesium, and zinc. However, it's still calorie-dense, so stick to 1-2 squares per day.",
            'sweeteners': "Artificial sweeteners are approved by food safety authorities, but opinions vary. Common ones like aspartame, sucralose, and stevia have been extensively studied. While they're generally recognized as safe in moderate amounts, some people prefer to avoid them. Natural alternatives include stevia, monk fruit, or simply reducing overall sweetness in your diet. The best approach depends on your individual health goals and preferences.",
            'labels': "When reading nutrition labels, focus on these key areas:\n\n1. **Serving Size** - Check if it's realistic for your consumption\n2. **Calories** - Balance with your daily needs\n3. **Added Sugars** - Aim for less than 25g daily\n4. **Sodium** - Keep below 2,300mg per day\n5. **Fiber** - Higher is better (25-30g daily)\n6. **Ingredients List** - Fewer, recognizable ingredients are best\n7. **Allergens** - Always check if you have sensitivities\n\nLook for foods with shorter ingredient lists and avoid those with many unrecognizable additives.",
            'snacks': "Here are some healthy snack alternatives:\n\nðŸ¥œ **Instead of chips:** Mixed nuts, roasted chickpeas, or air-popped popcorn\n\nðŸ« **Instead of candy:** Dark chocolate (70%+), fresh fruit, or yogurt with berries\n\nðŸª **Instead of cookies:** Homemade energy balls with dates and nuts, or rice cakes with almond butter\n\nðŸ¥¤ **Instead of soda:** Sparkling water with lemon, herbal tea, or coconut water\n\nðŸ§€ **Protein-rich:** Greek yogurt, hard-boiled eggs, or edamame\n\nRemember, preparation is key! Keep healthy snacks readily available."
        };
        
        // Send message function
        function sendMessage(messageText) {
            if (!messageText.trim()) return;
            
            // Hide welcome message
            if (welcomeMessage) {
                welcomeMessage.style.display = 'none';
            }
            
            // Hide suggestions
            suggestions.style.display = 'none';
            
            // Create user message
            const userMessage = createMessage(messageText, 'user');
            messagesContainer.appendChild(userMessage);
            
            // Clear input
            messageInput.value = '';
            messageInput.style.height = 'auto';
            
            // Scroll to bottom
            scrollToBottom();
            
            // Show typing indicator
            typingIndicator.classList.add('active');
            scrollToBottom();
            
            // Simulate AI response
            setTimeout(() => {
                typingIndicator.classList.remove('active');
                
                // Determine response
                let responseText;
                const lowerMessage = messageText.toLowerCase();
                
                if (lowerMessage.includes('dark chocolate') || lowerMessage.includes('chocolate')) {
                    responseText = aiResponses.default;
                } else if (lowerMessage.includes('sweetener') || lowerMessage.includes('artificial')) {
                    responseText = aiResponses.sweeteners;
                } else if (lowerMessage.includes('label') || lowerMessage.includes('nutrition')) {
                    responseText = aiResponses.labels;
                } else if (lowerMessage.includes('snack') || lowerMessage.includes('alternative')) {
                    responseText = aiResponses.snacks;
                } else if (lowerMessage.includes('e621') || lowerMessage.includes('msg')) {
                    responseText = "E621, commonly known as MSG (Monosodium Glutamate), is a flavor enhancer. While it's been controversial, most scientific studies show it's safe for the general population when consumed in normal amounts. However, some people report sensitivity to MSG, experiencing headaches or nausea. It's naturally present in some foods like tomatoes and cheese. If you're concerned, look for 'No MSG' labels on products.";
                } else if (lowerMessage.includes('palm oil')) {
                    responseText = "Palm oil has both health and environmental concerns. Nutritionally, it's high in saturated fats, which should be limited. Environmentally, palm oil production has been linked to deforestation. Look for products with sustainably sourced palm oil (RSPO certified) or alternatives like olive oil, coconut oil, or sunflower oil.";
                } else if (lowerMessage.includes('nova')) {
                    responseText = "The NOVA food classification system divides foods into 4 groups:\n\n**Group 1:** Unprocessed/minimally processed (fresh fruits, vegetables, grains)\n**Group 2:** Processed culinary ingredients (oils, butter, sugar, salt)\n**Group 3:** Processed foods (canned vegetables, cheese, bread)\n**Group 4:** Ultra-processed foods (soft drinks, packaged snacks, instant noodles)\n\nAim to eat mostly from Groups 1-2, limit Group 3, and minimize Group 4 for better health.";
                } else {
                    responseText = "I understand your question about " + messageText + ". While I don't have specific information on that topic right now, I recommend checking our product database or consulting with a registered dietitian for personalized advice. Is there anything else I can help you with regarding nutrition, ingredients, or healthy eating?";
                }
                
                const aiMessage = createMessage(responseText, 'ai');
                messagesContainer.appendChild(aiMessage);
                scrollToBottom();
            }, 1500);
        }
        
        // Create message element
        function createMessage(text, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.innerHTML = type === 'ai' ? '<i class="bi bi-robot"></i>' : userInitials;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            bubble.textContent = text;
            
            const time = document.createElement('div');
            time.className = 'message-time';
            time.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            contentDiv.appendChild(bubble);
            contentDiv.appendChild(time);
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
            
            return messageDiv;
        }
        
        // Scroll to bottom
        function scrollToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Quick question function
        function sendQuickQuestion(question) {
            messageInput.value = question;
            sendMessage(question);
        }
        
        // Form submit
        messageForm.addEventListener('submit', function(e) {
            e.preventDefault();
            sendMessage(messageInput.value);
        });
        
        // Enter to send (Shift+Enter for new line)
        messageInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage(messageInput.value);
            }
        });
    </script>
    
</body>
</html>
